## 1. `node_modules`의 역할

1. 의존성 관리: `package.json`에 명시된 의존성 목록을 기준으로 필요한 패키지들을 설치해서 관리 → 프로젝트를 다른 개발자와 공유하거나 배포할 때 프로젝트 의존성을 일관되게 유지할 수 있다.
2. 경로 해결: `node_modules` 폴더는 모듈을 검색하는 주요 경로, **Node.js**는 모듈을 찾기 위해 최상위 `node_modules`부터 필요한 위치까지 폴더 구조를 따라가며 탐색 → 외부 모듈을 간단하게 로드할 수 있다.
3. 네임스페이스 관리: 의존성 트리 내 여러 패키지가 동일한 이름의 모듈을 필요로 하는 경우, 중복 모듈이 서로 영향을 미치지 않도록 각 패키지가 독립적으로 사용할 수 있게 네임스페이스를 관리

## 2. `node_modules`의 구조

- 평탄화 구조: **Node.js**의 패키지 관리 시스템이 의존성을 효율적으로 관리하고, 버전 충돌을 방지하며, 모듈 로딩 속도를 높이는 데 기여

### 1. `.bin`

- `package.json` 파일에 정의된 `bin` 필드를 참조
  > [!TIP]
  >
  > #### `bin`
  >
  > `bin` 필드는 패키지의 실행 가능한 스크립트 혹은 바이너리 파일을 정의하는 데 사용된다.
- 패키지 관리자는 각 패키지의 `package.json`에 포함된 `bin` 필드를 읽고, 해당 실행 파일들을 `node_modules/.bin` 폴더에 심볼릭 링크로 생성
- `bin` 필드에 여러 명령어가 설정돼 있는 경우, `.bin` 폴더는 각 패키지의 명령어 단위로 설치된다.

> [!NOTE]
>
> - `node_modules/commitzen/package.json`
>
>   ```json
>   {
>     ...
>     "bin": {
>         "cz": "./bin/git-cz",
>         "git-cz": "./bin/git-cz",
>         "commitizen": "./bin/commitizen"
>     },
>     ...
>   }
>   ```
>
> - `node_modules` File Tree
>   ```bash
>   node_modules
>   ├── .bin
>   │   ├── commitizen
>   │   ├── cz
>   │   └── git-cz
>   └── commitzen
>       └── .bin
>           ├── commitizen
>           ├── commitizen.cmd
>           ├── commitizen.js
>           ├── git-cz
>           ├── git-cz.cmd
>           └── git-cz.js
>   ```

### 2. 서브 패키지 `node_modules` 폴더

- 여러 패키지에서 동일한 패키지의 동일 버전에 의존할 경우 **npm**은 기본적으로 평탄화 작업을 통해 이를 최상위 `node_modules` 폴더에 설치한다.
- 의존하는 버전이 서로 다를 경우에는 개별 패키지의 `node_modules` 서브 폴더에 필요한 버전을 추가로 설치해서 관리한다.
- 서로 다른 버전의 의존성을 사용하는 여러 패키지가 충돌 없이 필요한 모듈을 참조할 수 있으며, 프로젝트의 안정성과 모듈화가 좀 더 효율적으로 관리된다.

### 3. `.cache`

- 여러 빌드 도구와 패키지 관리 도구들이 성능 향상을 위해 캐시 데이터를 저장하는 장소
- **npm**에서 공식 지정한 폴더는 아니지만, 다양한 도구와 라이브러리들이 성능 최적화를 위해 암묵적으로 사용하는 경로가 되었으며 사실상 표준 관행으로 자리 잡았다.

## 3. 심볼릭 링크

- Symbolic Link: 파일 시스템 내에서 특정 파일이나 디렉터리에 대한 참조를 다른 위치에 생성하는 기능
  - **Node.js** 뿐만 아니라 대부분의 유닉스 계열 운영체제와 일부 다른 운영체제에서도 지원되는 일반적인 개념
  - 실제 파일의 복사본이 아닌, 원본 경로를 참조해서 원본 파일에 접근하는 일종의 '링크' 역할

### 1. 심볼릭 링크 직접 활용하기

- 패키지를 구현한 후 해당 `package.json` 파일이 위치한 경로에서 `npm link` 명령어를 실행해 심볼릭 링크를 전역에 생성할 수 있다.
  > [!TIP]
  >
  > #### `npm link`
  >
  > - `npm link`: 개발 중인 패키지를 다른 프로젝트에서 테스트하거나 쉽게 사용할 수 있도록 돕는 명령어
  >   - 심볼릭 링크를 통해 개발 중인 패키지를 전역으로 설치하거나 다른 프로젝트의 `node_modules` 폴더에 연결할 수 있다.
  >   - 생성된 심볼릭 링크는 기본적으로 전역 `node_modules` 폴더에 위치하며, `npm link <패키지명>` 명령어로 다른 프로젝트에서 참조할 수 있다.
  >   - 로컬 프로젝트에서 심볼릭 링크는 `npm unlink <패키지명>` 명령어를 사용해 제거할 수 있다.
  >   - 전역 심볼릭 링크는 `npm rm -g <패키지명>` 명령어를 사용해 제거할 수 있다.
- **npm 레지스트리**에 배포하지 않은 패키지나 변경 사항을 빠르게 반영하며 개발해야 하는 상황에서 유용하게 사용될 수 있다.
  1. 심볼릭 링크는 로컬에서 개발 중인 패키지를 쉽게 테스트하고, 원본 파일을 수정할 때마다 즉시 반영할 수 있어 **개발 효율성**을 크게 높여준다.
  2. 심볼릭 링크는 동일한 파일을 여러 위치에 복사하는 대신 단일 원본 파일에 대한 참조로 여러 위치에서 접근할 수 있어 **저장 공간을 절약**해준다.
  3. 심볼릭 링크는 원본 파일이 변경될 때 **자동으로 최신 상태로 유지**되므로 개발 생산성을 높이는 데 도움이 된다.

### 2. `node_modules`에서 심볼릭 링크의 활용

1. `node_modules/.bin`: **npm** 패키지의 CLI 도구가 심볼릭 링크로 연결되어 프로젝트 내에서 쉽게 실행할 수 있도록 한다. (예시: `npx cz`)
2. 워크스페이스: 여러 패키지를 하나의 프로젝트 내에서 함께 관리할 수 있게 해주는 기능으로, `package.json`의 `workspaces` 필드를 통해 관리할 패키지들의 경로를 지정할 수 있다.
   - 각 패키지가 `node_modules` 폴더 내에서 심볼릭 링크로 연결되어 의존성을 설치할 때 별도의 패키지 관리 없이도 각 패키지 간의 참조가 자동으로 처리된다.
3. 패키지 관리자: **pnpm**에서 디스크 공간 절약과 패키지 설치 속도 향상을 위해 심볼릭 링크를 적극적으로 활용한다.
